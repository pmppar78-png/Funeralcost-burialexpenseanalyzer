[build]
  publish = "."
  command = "node generate-pages.js"

[functions]
  directory = "netlify/functions"

# ─── Security & Performance Headers ───────────────────────────────

[[headers]]
  for = "/*"
  [headers.values]
    X-Frame-Options = "SAMEORIGIN"
    X-Content-Type-Options = "nosniff"
    X-XSS-Protection = "1; mode=block"
    Referrer-Policy = "strict-origin-when-cross-origin"
    Permissions-Policy = "camera=(), microphone=(), geolocation=(), payment=()"
    Content-Security-Policy = "default-src 'self'; script-src 'self' 'unsafe-inline' https://fonts.googleapis.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src 'self' https://fonts.gstatic.com; img-src 'self' data:; connect-src 'self' https://api.openai.com"

# ─── Cache static assets aggressively ─────────────────────────────

[[headers]]
  for = "/style.css"
  [headers.values]
    Cache-Control = "public, max-age=2592000, stale-while-revalidate=86400"

[[headers]]
  for = "/script.js"
  [headers.values]
    Cache-Control = "public, max-age=2592000, stale-while-revalidate=86400"

[[headers]]
  for = "/favicon.svg"
  [headers.values]
    Cache-Control = "public, max-age=2592000, stale-while-revalidate=86400"

[[headers]]
  for = "/sitemap.xml"
  [headers.values]
    Content-Type = "application/xml; charset=utf-8"
    Cache-Control = "public, max-age=86400"

[[headers]]
  for = "/robots.txt"
  [headers.values]
    Cache-Control = "public, max-age=86400"

# ─── HTML pages — cache briefly, revalidate ───────────────────────

[[headers]]
  for = "/*.html"
  [headers.values]
    Cache-Control = "public, max-age=3600, stale-while-revalidate=86400"

# ─── Domain-level redirects (one-hop, no chains) ─────────────────
# Canonical host: https://funeralcostanalyzer.com (non-www, HTTPS, no trailing slash except root)

# www → non-www (HTTPS is forced by Netlify automatically)
[[redirects]]
  from = "https://www.funeralcostanalyzer.com/*"
  to = "https://funeralcostanalyzer.com/:splat"
  status = 301
  force = true

# Netlify subdomain → canonical domain
[[redirects]]
  from = "https://funeralcostanalyzer.netlify.app/*"
  to = "https://funeralcostanalyzer.com/:splat"
  status = 301
  force = true

# ─── Redirects ────────────────────────────────────────────────────

# Clean URL aliases — existing pages
[[redirects]]
  from = "/green-burial"
  to = "/green-burial-options.html"
  status = 301

[[redirects]]
  from = "/prepaid-plans"
  to = "/prepaid-funeral-plans.html"
  status = 301

[[redirects]]
  from = "/ftc-funeral-rule"
  to = "/ftc-funeral-rule-guide.html"
  status = 301

[[redirects]]
  from = "/funeral-rule"
  to = "/ftc-funeral-rule-guide.html"
  status = 301

[[redirects]]
  from = "/affordable-funerals"
  to = "/cheap-funeral-options.html"
  status = 301

[[redirects]]
  from = "/state-costs"
  to = "/funeral-costs-by-state.html"
  status = 301

[[redirects]]
  from = "/checklist"
  to = "/planning-checklist.html"
  status = 301

[[redirects]]
  from = "/payment-help"
  to = "/funeral-payment-assistance.html"
  status = 301

[[redirects]]
  from = "/funeral-insurance"
  to = "/funeral-insurance-guide.html"
  status = 301

[[redirects]]
  from = "/home-funeral"
  to = "/home-funeral-guide.html"
  status = 301

[[redirects]]
  from = "/obituary-guide"
  to = "/obituary-writing-guide.html"
  status = 301

[[redirects]]
  from = "/write-obituary"
  to = "/obituary-writing-guide.html"
  status = 301

[[redirects]]
  from = "/grief"
  to = "/grief-resources.html"
  status = 301

[[redirects]]
  from = "/grief-support"
  to = "/grief-resources.html"
  status = 301

[[redirects]]
  from = "/privacy"
  to = "/privacy-policy.html"
  status = 301

# New page aliases
[[redirects]]
  from = "/contact"
  to = "/contact.html"
  status = 301

[[redirects]]
  from = "/medicaid-funeral"
  to = "/medicaid-funeral-assistance.html"
  status = 301

[[redirects]]
  from = "/final-expense-insurance"
  to = "/final-expense-insurance-guide.html"
  status = 301

[[redirects]]
  from = "/estate-planning"
  to = "/estate-planning-costs.html"
  status = 301

[[redirects]]
  from = "/probate-costs"
  to = "/probate-process-costs.html"
  status = 301

[[redirects]]
  from = "/funeral-financing"
  to = "/funeral-payment-plans.html"
  status = 301

[[redirects]]
  from = "/compare-prices"
  to = "/funeral-price-comparison.html"
  status = 301

[[redirects]]
  from = "/average-funeral-cost"
  to = "/average-funeral-cost-2026.html"
  status = 301

[[redirects]]
  from = "/cremation-jewelry"
  to = "/cremation-jewelry-guide.html"
  status = 301

[[redirects]]
  from = "/headstone-costs"
  to = "/headstone-monument-costs.html"
  status = 301

[[redirects]]
  from = "/funeral-flowers"
  to = "/funeral-flowers-guide.html"
  status = 301

[[redirects]]
  from = "/body-donation"
  to = "/body-donation-guide.html"
  status = 301

[[redirects]]
  from = "/military-funeral"
  to = "/military-funeral-honors.html"
  status = 301

[[redirects]]
  from = "/pet-cremation"
  to = "/pet-cremation-costs.html"
  status = 301

[[redirects]]
  from = "/crowdfunding-funeral"
  to = "/crowdfunding-funeral-costs.html"
  status = 301

[[redirects]]
  from = "/funeral-overcharging"
  to = "/funeral-overcharging-protection.html"
  status = 301

[[redirects]]
  from = "/consumer-rights"
  to = "/consumer-rights-funeral-pricing.html"
  status = 301

# National Funeral Cost Index & Research Assets
[[redirects]]
  from = "/cost-index"
  to = "/national-funeral-cost-index.html"
  status = 301

[[redirects]]
  from = "/funeral-cost-index"
  to = "/national-funeral-cost-index.html"
  status = 301

[[redirects]]
  from = "/national-index"
  to = "/national-funeral-cost-index.html"
  status = 301

[[redirects]]
  from = "/index-report"
  to = "/national-funeral-cost-index.html"
  status = 301

[[redirects]]
  from = "/cost-index-pdf"
  to = "/funeral-cost-index-pdf.html"
  status = 301

[[redirects]]
  from = "/printable-checklist"
  to = "/funeral-planning-checklist-printable.html"
  status = 301

[[redirects]]
  from = "/cost-worksheet"
  to = "/funeral-cost-comparison-worksheet.html"
  status = 301

[[redirects]]
  from = "/embed-widget"
  to = "/funeral-cost-widget.html"
  status = 301

[[redirects]]
  from = "/widget"
  to = "/funeral-cost-widget.html"
  status = 301
